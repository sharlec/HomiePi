<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Add Task · HomiePi</title>
    <style>
      body {
        margin: 0;
        min-height: 100vh;
        font-family: "Space Grotesk", Arial, sans-serif;
        background: #f8fafc;
        color: #0f172a;
        padding: 20px;
      }
      .card {
        max-width: 540px;
        margin: 0 auto;
        background: #fff;
        border-radius: 22px;
        padding: 24px;
        box-shadow: 0 24px 50px rgba(15, 23, 42, 0.15);
      }
      h1 {
        margin: 0 0 10px;
        font-size: 22px;
      }
      p {
        margin: 0 0 16px;
        color: #64748b;
        font-size: 14px;
      }
      .error {
        background: rgba(239, 68, 68, 0.12);
        color: #b91c1c;
        padding: 10px 12px;
        border-radius: 12px;
        margin-bottom: 16px;
        font-size: 13px;
      }
      .success {
        background: rgba(34, 197, 94, 0.12);
        color: #15803d;
        padding: 14px 16px;
        border-radius: 12px;
        font-size: 14px;
        text-align: center;
      }
      .field {
        display: flex;
        flex-direction: column;
        gap: 8px;
        margin-bottom: 14px;
        font-size: 12px;
        letter-spacing: 0.4px;
        text-transform: uppercase;
        color: #64748b;
      }
      input[type="text"],
      input[type="number"] {
        border: 1px solid #e2e8f0;
        border-radius: 12px;
        padding: 12px 14px;
        font-size: 14px;
        font-family: inherit;
      }
      .user-list {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
        gap: 10px;
        margin-bottom: 16px;
      }
      .user-card {
        border: 1px solid #e2e8f0;
        border-radius: 16px;
        padding: 10px;
        display: flex;
        align-items: center;
        gap: 10px;
        cursor: pointer;
      }
      .user-card input {
        display: none;
      }
      .user-card.active {
        border-color: #f97316;
        background: rgba(249, 115, 22, 0.08);
      }
      .avatar {
        width: 36px;
        height: 36px;
        border-radius: 12px;
        color: #fff;
        display: grid;
        place-items: center;
        font-weight: 600;
      }
      .week-grid {
        display: flex;
        flex-wrap: wrap;
        gap: 8px;
      }
      .week-chip {
        border: 1px solid #e2e8f0;
        background: #f8fafc;
        border-radius: 999px;
        padding: 6px 12px;
        font-size: 11px;
        text-transform: uppercase;
        cursor: pointer;
      }
      .week-chip input {
        display: none;
      }
      .week-chip.active {
        background: #0f172a;
        color: #fff;
        border-color: #0f172a;
      }
      .actions {
        margin-top: 16px;
        display: flex;
        justify-content: flex-end;
      }
      .btn {
        border: none;
        border-radius: 12px;
        padding: 10px 16px;
        font-size: 14px;
        cursor: pointer;
        background: #f97316;
        color: #fff;
        box-shadow: 0 12px 24px rgba(249, 115, 22, 0.3);
      }
    </style>
  </head>
  <body>
    <div class="card">
      {% if success %}
        <div class="success">Task added! You can close this page.</div>
      {% else %}
        <h1>Add a new task</h1>
        <p>Quickly add a habit for today’s dashboard.</p>

        {% if no_users %}
          <div class="error">No users yet. Please register a user first.</div>
        {% endif %}

        {% if error %}
          <div class="error">{{ error }}</div>
        {% endif %}

        <form method="post">
          {% csrf_token %}
          <input type="hidden" name="token" value="{{ token }}" />

          {% if not token_user and not no_users %}
            <div class="field">Choose user</div>
            <div class="user-list">
              {% for user in users %}
                <label class="user-card" data-user>
                  <input type="radio" name="user_id" value="{{ user.id }}" />
                  <div class="avatar" style="background: {{ user.color }}">{{ user.initials }}</div>
                  <div>{{ user.username }}</div>
                </label>
              {% endfor %}
            </div>
          {% else %}
            <input type="hidden" name="user_id" value="{{ token_user.id }}" />
          {% endif %}

          <label class="field">
            Task name
            <input type="text" name="name" placeholder="e.g. Drink water" required />
          </label>

          <label class="field">
            Daily repeat
            <input type="number" name="repeat" min="1" value="1" />
          </label>

          <div class="field">Weekly schedule</div>
          <div class="week-grid">
            {% for day in "0123456" %}
              <label class="week-chip" data-week>
                <input type="checkbox" name="week" value="{{ day }}" />
                {% if day == "0" %}Sun{% elif day == "1" %}Mon{% elif day == "2" %}Tue{% elif day == "3" %}Wed{% elif day == "4" %}Thu{% elif day == "5" %}Fri{% else %}Sat{% endif %}
              </label>
            {% endfor %}
          </div>

          <div class="actions">
            <button class="btn" type="submit">Add Task</button>
          </div>
        </form>
      {% endif %}
    </div>

    <script>
      const userCards = document.querySelectorAll("[data-user]");
      userCards.forEach((card) => {
        card.addEventListener("click", () => {
          userCards.forEach((c) => c.classList.remove("active"));
          card.classList.add("active");
          const input = card.querySelector("input");
          if (input) input.checked = true;
        });
      });

      const weekChips = document.querySelectorAll("[data-week]");
      weekChips.forEach((chip) => {
        chip.addEventListener("click", () => {
          chip.classList.toggle("active");
          const input = chip.querySelector("input");
          if (input) input.checked = !input.checked;
        });
      });
    </script>
  </body>
</html>
